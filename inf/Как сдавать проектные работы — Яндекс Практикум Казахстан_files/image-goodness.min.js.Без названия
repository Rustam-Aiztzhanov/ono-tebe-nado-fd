!function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,"symbol"==typeof(r=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key))?r:String(r)),i)}var r}function n(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function i(e){return i=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},i(e)}function r(e,t){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},r(e,t)}function a(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=i(e);if(t){var a=i(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,n)}}Ya.Rum.getSetting("savedDeltasLimit"),document.createElement("link");var o=function(){function t(n){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=i.src,a=i.callback;e(this,t),this.img=n,this.src=r||this.img.src,this.className=this.img.className,this.callback=a}return n(t,[{key:"calculateDimensions",value:function(){return this.w=this.img.offsetWidth,this.h=this.img.offsetHeight,this.nw=this.img.naturalWidth,this.nh=this.img.naturalHeight,this.calculateScale(),Promise.resolve()}},{key:"calculateScale",value:function(){this.xScale=this.nw/this.w,this.yScale=this.nh/this.h}},{key:"checkDimensions",value:function(){this.shouldIgnoreImageBefore()||this.calculateDimensions().then(function(){var e=this.w,t=this.h,n=this.nw,i=this.nh;if(0!==e&&0!==t&&!(n<=e&&i<=t||2===this.xScale&&2===this.yScale&&this.src.match(/_2x$/)||this.xScale<3&&this.xScale>1/3&&this.yScale<3&&this.yScale>1/3)){var r=Math.round((n*i-e*t)/1e4);r<4||this.callback({w:e,h:t,nw:n,nh:i,src:this.src,className:this.className,element:this.img,extraTrafficKb:r})}}.bind(this))}},{key:"shouldIgnoreImageBefore",value:function(){return!1}}]),t}(),s=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&r(e,t)}(o,t);var i=a(o);function o(){return e(this,o),i.apply(this,arguments)}return n(o,[{key:"calculateDimensions",value:function(){return Promise.all([this.calculateImgDimensions(),this.calculateBgDimensions()]).then(function(){this.calculateScale()}.bind(this))}},{key:"calculateImgDimensions",value:function(){return new Promise(function(e){var t=new Image;t.onload=function(){t.onload=t.onerror=null,this.nw=t.naturalWidth,this.nh=t.naturalHeight,e()}.bind(this),t.onerror=function(){t.onload=t.onerror=null,this.nw=this.nh=0,e()}.bind(this),t.src=this.src}.bind(this))}},{key:"calculateBgDimensions",value:function(){var e=this.img.style.backgroundSize;if(e){var t=e.match(/(\d+)px (\d+)px/);if(t)return this.w=parseInt(t[1]),void(this.h=parseInt(t[2]))}this.w=this.img.offsetWidth||0,this.h=this.img.offsetHeight||0}},{key:"shouldIgnoreImageBefore",value:function(){var e=this.src;return"none"===e||0===e.indexOf("https://favicon.yandex.net/favicon/v2/")||(0===e.indexOf("data:image/")?e.length<1e3:!/^(https?:\/\/|\/\/)/.test(e))}}]),o}(o);!function(e){if(e.enabled&&window.PerformanceObserver){var t,n,i,r,a,c,l,u,f,h,d,m="690.2096.277",g=10,v=15e3,p="data-uri";y(),e._onInit.push(y),e.getImageGoodnessAdditionalParams=function(e,t){for(var n={},i=k(null==e?void 0:e.target),r=0,a=Object.keys(i);r<a.length;r++){var o=a[r];n["-f_".concat(o)]=i[o]}for(var s=k(null==t?void 0:t.target),c=0,l=Object.keys(s);c<l.length;c++){var u=l[c];n["-l_".concat(u)]=s[u]}return n}}function y(){t=0,n=0,i=!1,r=!1,a=void 0,c=void 0,l=void 0,u=void 0,f=void 0,h=0,d=0,e.onReady(b)}function b(){if(!e.isVisibilityChanged()||e.getSetting("forcePaintTimeSending")){var y=performance.timing;a=y.responseEnd-y.navigationStart;var b=function(){for(var e=document.querySelectorAll('img,[data-rcid],[style*="background"]'),t=[],n=0;n<e.length;n++){var i,r=e[n];"lazy"!==r.loading&&(r.src?i=r.src:0===(i=getComputedStyle(r).backgroundImage).indexOf("url(")&&('"'!==(i=i.slice(4,-1))[0]&&"'"!==i[0]||(i=i.slice(1,-1))),i&&"none"!==i&&(0===i.indexOf("data:")&&(i=p),t.push({elem:r,url:i})))}return t}();requestAnimationFrame((function(){if(e.getSetting("forcePaintTimeSending")||!e.isVisibilityChanged())try{var y=function(e){for(var t=document.documentElement,n=t.clientWidth,i=t.clientHeight,r=[],a=0;a<e.length;a++){var o=e[a],s=o.elem.getBoundingClientRect();s.width<g||s.height<g||s.bottom<=0||s.top>=i||s.right<=0||s.left>=n||r.push(o)}return r}(b);e.getSetting("sendImageMismatch")&&function(){function t(e){++d,h+=e.extraTrafficKb}for(var n=document.querySelectorAll("img[src]"),i=0;i<n.length;i++)new o(n[i],{callback:t}).checkDimensions();for(var r=document.querySelectorAll("*"),a=0;a<r.length;a++){var c=r[a],l=getComputedStyle(c).backgroundImage;if(0===l.indexOf("url("))if(-1!==(l=l.replace(/^url\("?|"?\)$/g,"")).indexOf("url("))for(var u=l.split(/"?\),\s*url\("?/),f=0;f<u.length;f++)new s(c,{src:u[f],callback:t}).checkDimensions();else new s(c,{src:l,callback:t}).checkDimensions()}e.emit("metric:observed",{metricName:m,value:null,params:{totalImageDimensionsMismatchCount:d,totalExtraTrafficKb:h}})}(),function(o){if(o.length){for(var s,h,d=document.createElement("link"),g={},y=0;y<o.length;y++){var b=o[y];b.url!==p?(d.href=b.url,g[d.href]=b):(i=!0,s=b.elem)}if(i&&(c=a,l=a,e.getSetting("sendExtraImageGoodness")&&(u=f={target:s})),0===(t=Object.keys(g).length))return w("e0");var k=e._observe("resource",(function(o){for(var s,d,v=0;v<o.length;v++){var p=o[v];if(g[p.name]){var y,b,S=p.responseEnd;S||(r=!0,S=a+p.duration),(void 0===c||S<c)&&(c=S,e.getSetting("sendExtraImageGoodness")&&(u={entry:p,target:null===(y=g[p.name])||void 0===y?void 0:y.elem})),(void 0===l||S>l)&&(l=S,e.getSetting("sendExtraImageGoodness")&&(f={entry:p,target:null===(b=g[p.name])||void 0===b?void 0:b.elem})),++n===t&&(k.disconnect(),w("ok"),clearTimeout(h))}}var x=e.normalize(c),O=e.normalize(l);e.emit("metric:observed",{metricName:m,value:null,params:{firstTime:x,lastTime:O,resourcesExpected:t,resourcesFound:n,hasDataUri:i,hasUnknown:r,firstTarget:null===(s=u)||void 0===s?void 0:s.target,lastTarget:null===(d=f)||void 0===d?void 0:d.target}})}));h=e._timeout((function(){try{k.disconnect(),w("tm")}catch(e){}}),v)}}(y)}catch(e){}}))}}function w(a){var o,s,g,v=null!=c?e.normalize(c):c,p=null!=l?e.normalize(l):l,y=e._getCommonVars().concat(["ft="+v,"lt="+p,"er="+t,"fr="+n,"t="+(a||"unk"),i&&"d=1",r&&"u=1"]);e.getSetting("sendImageMismatch")&&y.push("mm="+d,"mmkb="+h),e.getSetting("sendExtraImageGoodness")&&(g=e.getImageGoodnessAdditionalParams(u,f))&&function(e,t){if(t){if(t.isCanceled&&t.isCanceled())return!1;var n=e.reduce((function(e,t,n){return"string"==typeof t&&(e[t.split("=")[0]]=n),e}),{});Object.keys(t).forEach((function(i){if("function"!=typeof t[i]){var r=n[i],a=i+"="+t[i];void 0===r?e.push(a):e[r]=a}}))}}(y,g),e.emit("metric:sent",{metricName:m,value:null,params:{firstTime:v,lastTime:p,resourcesExpected:t,resourcesFound:n,finalizeType:a,hasDataUri:i,hasUnknown:r,additionalParams:g,totalImageDimensionsMismatchCount:d,totalExtraTrafficKb:h,firstTarget:null===(o=u)||void 0===o?void 0:o.target,lastTarget:null===(s=f)||void 0===s?void 0:s.target}}),e.sendCounter(m,y)}function k(e){var t={};if(!e)return t;if(e.closest){var n,i,r=e.closest("[data-cid]"),a=r&&r.getAttribute("data-cid");a&&(t.cid=a);var o=null===(n=e.closest("[data-layout-part]"))||void 0===n||null===(i=n.dataset)||void 0===i?void 0:i.layoutPart;o&&(t.lp=o)}t.className=encodeURIComponent(e.className),t.tagName=e.tagName.toLowerCase();var s=e.getBoundingClientRect();return t.width=s.width,t.height=s.height,t}}(Ya.Rum)}();
